<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>404 - Not Found</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body { height: 100%; margin: 0; padding: 0; background: #111; color: #fff; font-family: 'Segoe UI', Arial, sans-serif; overflow: hidden; }
    #container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -55%); text-align: center; width: 100vw; }
    h1 { font-size: 5vw; margin-bottom: 1vw; letter-spacing: 0.2em; color: #fff; font-weight: bold; text-shadow: 0 2px 8px #000; }
    p { font-size: 1.6vw; margin-bottom: 2vw; color: #fff; text-shadow: 0 2px 8px #000; }
    #gameCanvas { background: #111; display: block; margin: 0 auto; border: 2px solid #fff; border-radius: 16px; box-shadow: 0 0 16px #000; }
    #retryBtn { margin-top: 1vw; background: none; color: #fff; border: 1.5px solid #fff; border-radius: 20px; padding: 0.5em 2em; font-size: 1.2vw; cursor: pointer; transition: background 0.2s, color 0.2s; display: none; }
    #retryBtn:hover { background: #fff; color: #111; }
    @media (max-width: 700px) {
      #container { width: 100vw; }
      h1 { font-size: 9vw;}
      p { font-size: 3vw;}
      #gameCanvas { width: 320px; height: 90px; }
      #retryBtn { font-size: 3vw;}
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>404 Not Found</h1>
    <p>ページが見つかりませんでした。<br>
    ミニゲームで気を紛らわせましょう！<br>
    <small>スペースキー または タップでジャンプ</small></p>
    <canvas id="gameCanvas" width="600" height="150"></canvas>
    <br>
    <button id="retryBtn">もう一度プレイ</button>
  </div>
  <script>
    // SVG Type2バス全パス（短縮例）
    const svgPaths = [
      `M940 1348 c-25 -3 -72 -7 -104 -7 -33 -1 -85 -5 -115 -11 -31 -5
-138 -16 -237 -24 -192 -15 -226 -24 -262 -71 -11 -14 -25 -25 -32 -25 -7 0
-10 -7 -6 -15 3 -8 -1 -30 -9 -48 -25 -60 -57 -229 -62 -327 -3 -52 -9 -100
-14 -106 -4 -5 -6 -26 -3 -46 4 -20 1 -45 -6 -59 -9 -15 -9 -24 -2 -27 6 -2 8
-31 5 -81 -4 -53 -2 -80 6 -85 6 -4 11 -12 11 -18 0 -6 -16 2 -35 17 -62 46
-70 36 -68 -85 1 -58 2 -108 2 -112 1 -5 17 -8 36 -8 19 0 35 -4 35 -10 0 -5
14 -10 30 -10 21 0 30 5 30 16 0 13 8 15 51 9 39 -5 54 -4 60 6 6 10 9 8 9 -7
0 -25 23 -34 87 -34 40 0 43 -2 70 -52 39 -74 113 -118 195 -118 67 0 108 15
157 56 36 30 81 114 81 152 0 15 6 22 19 22 10 0 24 7 31 15 11 13 87 15 571
15 l559 0 0 -31 c0 -84 59 -176 134 -210 105 -48 234 -7 293 91 29 47 33 63
33 122 0 70 10 85 31 46 7 -13 17 -26 23 -30 6 -4 77 -8 159 -8 91 0 147 -4
147 -10 0 -16 67 -12 84 5 13 13 15 13 18 -7 7 -48 23 -20 26 44 3 62 1 68
-17 68 -18 0 -20 8 -23 63 -2 51 -6 62 -20 61 -13 -1 -18 9 -23 45 -18 158
-71 368 -100 401 -7 8 -45 69 -84 135 -63 106 -68 120 -51 123 21 4 29 32 9
32 -6 0 -20 11 -31 25 -46 59 -142 79 -465 97 -117 6 -213 16 -213 21 0 10
-947 6 -1020 -5z m868 -8 c135 0 142 -1 142 -20 0 -20 -7 -20 -595 -20 -522 0
-595 2 -595 15 0 12 14 15 63 16 492 12 751 16 792 13 28 -2 114 -4 193 -4z
m577 -40 c55 -6 123 -17 151 -25 48 -14 104 -48 104 -63 0 -4 -67 -7 -149 -7
-114 0 -147 3 -139 12 5 6 8 24 6 40 l-3 28 -170 0 -170 0 -3 -28 c-2 -16 1
-34 7 -41 8 -10 0 -12 -39 -12 -48 1 -61 8 -40 21 14 9 12 55 -2 56 -7 0 -3 4
10 9 12 5 22 15 22 22 0 10 32 12 157 6 87 -4 203 -12 258 -18z m-1635 0 c0
-5 6 -10 13 -10 7 0 12 -14 12 -37 l0 -38 -275 -5 c-151 -3 -277 -3 -280 -2
-11 8 53 52 88 62 34 9 306 35 405 39 20 0 37 -3 37 -9z m432 -39 c-2 -16 1
-32 7 -35 22 -14 10 -21 -38 -21 -38 0 -47 3 -39 12 6 7 8 26 6 43 -4 29 -3
30 32 30 35 0 36 -2 32 -29z m416 10 c-9 -15 -8 -24 4 -43 l16 -24 -53 0 -53
0 16 24 c12 19 13 28 4 43 -11 18 -9 19 33 19 42 0 44 -1 33 -19z m-488 -10
c0 -39 -8 -41 -165 -41 -157 0 -165 2 -165 41 0 5 71 9 165 9 94 0 165 -4 165
-9z m408 -13 c-3 -23 -5 -23 -158 -23 -153 0 -155 0 -158 23 l-3 22 161 0 161
0 -3 -22z m410 0 c-3 -23 -5 -23 -158 -23 -153 0 -155 0 -158 23 l-3 22 161 0
161 0 -3 -22z m422 10 c-1 -36 -14 -39 -171 -36 -151 3 -154 3 -157 26 l-3 22
165 0 c126 0 166 -3 166 -12z m-1209 -173 c-3 -163 -15 -189 -21 -45 l-5 125
-170 0 -170 0 -3 -127 c-3 -125 -3 -128 -25 -128 -22 0 -22 2 -19 106 2 58 1
116 -2 130 l-6 24 -175 0 c-210 0 -199 9 -193 -151 3 -107 3 -109 -19 -109
-22 0 -22 3 -25 128 l-3 127 -47 3 c-27 2 -48 7 -48 11 0 5 210 8 466 7 l467
-1 -2 -100z m417 -37 c2 -111 0 -138 -11 -138 -11 0 -13 22 -9 108 7 160 16
152 -183 152 l-165 0 -6 -24 c-3 -14 -4 -72 -2 -130 2 -68 -1 -105 -7 -103 -6
2 -11 61 -13 141 l-3 136 198 -2 198 -3 3 -137z m410 6 c-2 -80 -7 -139 -13
-141 -6 -2 -9 35 -7 103 2 58 1 116 -2 130 l-6 24 -166 0 c-147 0 -165 -2
-172 -17 -4 -10 -7 -69 -7 -130 0 -84 -3 -113 -12 -113 -10 0 -13 35 -13 139
l0 139 200 2 201 1 -3 -137z m54 120 c-20 -14 -22 -24 -23 -117 -2 -157 -16
-172 -18 -19 -1 73 1 137 4 143 4 5 18 9 33 9 l26 0 -22 -16z m261 9 c-34 -2
-93 -2 -130 0 -37 2 -9 3 62 3 72 0 102 -1 68 -3z m397 -110 c35 -60 70 -118
78 -130 14 -23 13 -23 -27 -23 l-41 0 0 43 c-1 37 -23 88 -34 76 -9 -10 -13
-90 -5 -95 22 -13 4 -22 -57 -29 -44 -4 -70 -3 -77 4 -8 8 5 11 46 11 53 0 58
2 67 26 9 23 3 38 -42 117 -29 50 -54 95 -56 99 -2 4 16 8 41 8 l45 0 62 -107z
m-465 -28 l0 -125 -97 0 -98 0 0 118 c0 65 3 122 7 125 3 4 47 7 97 7 l91 0 0
-125z m217 38 c20 -49 43 -105 52 -125 l16 -38 -135 0 -135 0 0 125 0 125 83
0 83 0 36 -87z m43 77 l-50 -6 44 -5 c45 -4 45 -4 99 -97 36 -62 51 -97 45
-103 -6 -6 -32 -9 -58 -7 l-49 3 -42 100 c-23 55 -43 106 -43 113 -1 8 15 12
52 10 l52 -1 -50 -7z m-2180 -120 l0 -115 -77 -3 -78 -3 6 33 c12 67 33 154
43 181 10 26 14 28 58 25 l48 -3 0 -115z m413 -3 l3 -117 -168 2 -168 3 -3
104 c-1 58 0 111 2 118 4 11 39 13 168 11 l163 -3 3 -118z m397 101 c3 -13 5
-66 3 -118 l-3 -95 -159 0 -159 0 1 110 c1 61 2 113 2 118 0 4 70 7 155 7 152
0 155 0 160 -22z m413 -100 l3 -118 -161 0 -160 0 0 113 c0 63 3 117 7 121 4
3 75 5 157 4 l151 -3 3 -117z m410 0 l3 -118 -161 0 -160 0 0 113 c0 63 3 117
7 121 4 3 75 5 157 4 l151 -3 3 -117z m-785 -158 c-5 -20 -14 -20 -509 -20
-324 0 -505 4 -509 10 -3 6 -3 15 0 20 4 6 186 10 515 10 503 0 508 0 503 -20z
m417 0 c0 -19 -7 -20 -200 -20 -193 0 -200 1 -200 20 0 19 7 20 200 20 193 0
200 -1 200 -20z m410 0 c0 -19 -7 -20 -200 -20 -193 0 -200 1 -200 20 0 19 7
20 200 20 193 0 200 -1 200 -20z m648 -1 c30 -9 42 -19 42 -32 0 -15 -5 -18
-22 -13 -69 20 -158 26 -385 26 -204 0 -253 3 -253 13 0 8 3 17 7 21 14 13
563 0 611 -15z m203 -73 l28 -89 -45 51 c-24 28 -60 60 -79 72 -21 13 -35 30
-35 41 0 18 6 20 52 17 l52 -3 27 -89z m-1681 -153 c0 -117 -4 -194 -10 -198
-13 -8 -13 -45 0 -45 6 0 10 -16 10 -35 l0 -34 -102 -3 c-84 -2 -103 -6 -103
-18 0 -13 66 -15 528 -18 343 -1 527 -6 527 -12 0 -7 -181 -9 -527 -8 l-528 3
-32 55 c-18 30 -37 61 -43 68 -8 9 -69 12 -243 12 -128 0 -237 -4 -243 -8 -6
-4 -25 -31 -41 -60 -22 -38 -32 -49 -36 -38 -5 12 -21 16 -69 16 -50 0 -66 4
-85 22 -22 21 -23 27 -23 183 0 89 3 195 6 236 l7 74 503 0 504 0 0 -192z
m420 -60 l0 -253 -200 0 -200 0 0 253 0 252 200 0 200 0 0 -252z m410 0 l-1
-253 -199 0 -200 0 0 253 0 252 200 0 200 0 0 -252z m17 -41 c-1 -53 -3 -7 -3
103 0 110 2 154 3 97 2 -57 2 -147 0 -200z m428 285 c155 -2 198 -6 232 -21
40 -17 42 -19 54 -84 7 -37 14 -137 15 -222 l2 -155 -87 3 c-47 2 -91 5 -98 7
-7 2 -30 40 -52 83 -28 56 -47 81 -63 86 -13 3 -112 6 -220 6 l-198 0 0 94 0
94 38 -9 c85 -20 141 -4 126 35 -8 20 -46 30 -82 22 -84 -21 -82 -22 -82 21 0
22 2 42 4 44 2 2 53 3 113 2 59 -2 194 -4 298 -6z m344 -43 c60 -54 97 -113
106 -169 6 -39 6 -38 -23 20 -19 39 -50 80 -90 117 -58 53 -75 78 -53 78 5 0
32 -21 60 -46z m71 -142 c0 -4 -10 -12 -22 -17 -20 -8 -23 -19 -26 -68 -3 -62
8 -87 39 -87 10 0 25 10 33 22 16 22 16 21 16 -18 0 -39 -1 -40 -33 -36 -42 5
-76 -22 -86 -68 -6 -28 -8 -20 -9 40 -1 73 -16 244 -28 325 l-6 40 61 -63 c34
-34 61 -66 61 -70z m20 -92 c0 -27 -4 -51 -9 -55 -18 -10 -33 36 -27 79 4 29
3 37 -4 26 -13 -20 -13 -76 1 -103 10 -21 10 -21 -5 -3 -18 23 -21 78 -6 107
9 15 15 17 30 9 16 -8 20 -21 20 -60z m-424 -48 c13 -9 94 -162 85 -162 -3 0
-20 26 -37 58 -17 32 -46 67 -65 80 -31 22 -42 23 -146 20 l-112 -3 -41 -40
c-39 -38 -86 -135 -77 -160 3 -6 -4 -12 -14 -12 -11 -1 -17 2 -14 8 4 5 -201
10 -527 12 l-533 2 538 0 c295 0 537 3 537 7 0 4 -4 10 -10 13 -5 3 -10 46
-10 96 l0 89 208 0 c114 0 212 -4 218 -8z m-20 -39 c32 -23 101 -140 89 -151
-4 -4 -12 2 -19 13 -27 48 -103 112 -149 124 -86 24 -202 -12 -243 -75 -22
-33 -29 -24 -11 13 16 30 59 73 92 92 12 7 57 10 115 9 79 -3 100 -7 126 -25z
m524 -118 l0 -104 -82 4 c-46 3 -130 7 -188 9 -92 5 -107 8 -122 27 -39 47
-31 49 166 49 102 0 187 -3 189 -7 3 -5 -48 -7 -113 -5 -120 3 -160 -5 -160
-32 0 -21 18 -24 156 -27 l129 -2 3 37 c3 31 0 38 -17 43 -25 7 -25 4 -1 48
11 19 17 42 14 50 -4 10 0 15 10 15 14 0 16 -15 16 -105z m-548 59 c173 -122
89 -387 -123 -387 -114 0 -200 82 -207 197 -5 71 15 121 65 167 51 48 83 60
155 56 56 -2 74 -8 110 -33z m-2337 6 c3 -5 1 -10 -4 -10 -19 0 -12 -28 9 -33
27 -7 27 -47 -1 -54 -17 -5 -20 -12 -17 -47 2 -32 7 -42 23 -44 17 -3 17 -1 5
7 -11 8 6 11 64 11 60 0 84 4 98 17 10 9 18 20 18 24 0 5 -46 10 -102 12
l-103 3 128 2 c119 2 127 1 118 -15 -28 -52 -35 -55 -117 -59 -43 -1 -92 -4
-109 -6 l-30 -3 -3 103 c-2 94 5 122 23 92z m2800 1 c-56 -6 -60 -8 -63 -33
-2 -16 -8 -28 -13 -28 -14 0 -11 23 7 48 13 19 24 22 72 20 l57 -1 -60 -6z m35
-18 c-1 -19 -28 -40 -57 -46 -30 -6 -33 -4 -33 17 0 12 3 26 7 29 9 10 83 9 83
0z m-2774 -29 c19 -15 34 -31 34 -37 0 -6 -12 1 -27 16 -16 14 -39 30 -53 36
-19 7 -20 10 -7 10 10 1 34 -11 53 -25z m319 -10 c-14 -20 -25 -43 -25 -50 0
-10 -13 -14 -40 -14 -51 0 -45 19 19 66 60 44 77 43 46 -2z m358 6 c83 -98 49
-260 -67 -319 -184 -95 -381 99 -289 284 33 65 33 65 189 65 l142 0 25 -30z
m73 -17 c30 -26 54 -51 54 -57 0 -5 -6 -2 -13 9 -10 13 -21 16 -40 11 -20 -5
-27 -3 -27 7 0 8 -9 26 -20 40 -20 25 -25 37 -14 37 3 0 30 -21 60 -47z m32
-67 c6 -29 -15 -43 -35 -24 -14 14 -14 20 -3 33 16 19 34 15 38 -9z m2002 9 c0
-12 -19 -15 -114 -15 -116 0 -150 5 -140 21 3 5 61 9 130 9 104 0 124 -2 124
-15z m-2676 -20 c-9 -22 -174 -22 -174 0 0 12 17 15 90 15 75 0 88 -2 84 -15z
m176 -20 l0 -35 -49 0 c-64 0 -87 23 -51 51 14 10 41 19 63 19 36 0 37 -1 37
-35z m0 -55 c0 -5 -18 -10 -39 -10 -22 0 -43 5 -46 10 -4 6 12 10 39 10 25 0
46 -4 46 -10z`,
      `M350 830 c0 -6 38 -10 94 -10 53 0 98 4 101 10 4 6 -30 10 -94 10
-61 0 -101 -4 -101 -10z`,
      `M350 802 c0 -4 37 -6 83 -4 125 4 134 9 20 11 -57 0 -103 -2 -103 -7z`,
      `M448 773 c56 -2 102 -8 102 -13 0 -5 -46 -11 -102 -13 l-103 -3 103
-2 c67 -1 102 -6 102 -13 0 -8 -31 -10 -100 -7 -55 2 -100 0 -100 -4 0 -4 45
-8 99 -8 96 0 100 -1 103 -22 3 -20 10 -23 61 -26 l57 -3 0 60 0 60 -162 -2
c-115 -1 -133 -2 -60 -4z m212 -53 l0 -50 -45 0 -45 0 0 50 0 50 45 0 45 0 0
-50z`,
      `M350 690 c0 -6 38 -10 95 -10 57 0 95 4 95 10 0 6 -38 10 -95 10 -57
0 -95 -4 -95 -10z`,
      `M350 660 c0 -6 38 -10 94 -10 53 0 98 4 101 10 4 6 -30 10 -94 10
-61 0 -101 -4 -101 -10z`,
      `M398 633 c28 -2 76 -2 105 0 28 2 5 3 -53 3 -58 0 -81 -1 -52 -3z`,
      `M398 603 c28 -2 76 -2 105 0 28 2 5 3 -53 3 -58 0 -81 -1 -52 -3z`,
      `M1635 771 c-3 -6 -15 -11 -25 -11 -27 0 -40 -84 -17 -107 13 -14 20
-14 47 -3 41 17 62 50 58 92 -2 27 -8 34 -30 36 -14 2 -29 -2 -33 -7z m55 -50
c0 -17 -50 -61 -69 -61 -26 0 -34 15 -27 46 6 21 12 24 51 24 25 0 45 -4 45
-9z`,
      `M2205 376 c-42 -18 -83 -69 -91 -112 -9 -48 19 -118 58 -146 44 -31
123 -35 166 -9 100 63 95 205 -8 259 -50 25 -81 27 -125 8z m131 -25 c32 -20
64 -74 64 -110 0 -35 -26 -86 -55 -109 -41 -33 -86 -37 -138 -14 -54 24 -77
62 -77 128 0 41 5 51 39 85 34 35 44 39 87 39 30 0 61 -7 80 -19z`,
      `M2210 343 c-50 -26 -76 -83 -61 -132 14 -49 50 -81 98 -88 75 -10
133 43 133 122 0 26 -8 44 -32 70 -41 44 -88 54 -138 28z m22 -13 c-30 -14
-47 -30 -57 -52 -8 -18 -14 -26 -15 -18 0 35 65 90 105 89 6 0 -9 -9 -33 -19z
m94 -5 c30 -21 47 -68 40 -109 -10 -55 -75 -96 -129 -82 -33 8 -77 54 -77 80
1 17 4 15 14 -10 16 -37 51 -64 83 -64 55 0 103 48 103 103 0 29 -34 75 -64
87 -13 6 -15 9 -6 9 9 1 25 -6 36 -14z m-8 -25 c45 -42 36 -107 -18 -135 -83
-43 -161 65 -95 130 30 31 82 33 113 5z`,
      `M2236 261 c-19 -21 -12 -48 15 -56 42 -14 68 44 30 65 -25 13 -25 13
-45 -9z m44 -21 c0 -13 -7 -20 -20 -20 -19 0 -27 20 -13 33 13 14 33 6 33 -13z`,
      `M553 370 c-140 -63 -91 -280 62 -280 91 0 165 84 150 170 -9 53 -55
106 -103 120 -50 13 -60 13 -109 -10z m158 -39 c34 -34 39 -44 39 -86 0 -66
-28 -109 -86 -131 -56 -21 -110 -8 -148 36 -77 93 -16 220 107 220 44 0 53 -4
88 -39z`,
      `M574 351 c-63 -27 -91 -109 -59 -171 32 -62 129 -78 181 -29 76 71
36 191 -67 204 -19 3 -43 1 -55 -4z m80 -15 c35 -15 66 -50 66 -76 -1 -8 -7 0
-15 18 -17 38 -71 66 -110 56 -33 -8 -75 -59 -75 -90 0 -56 36 -92 105 -107
15 -4 14 -5 -6 -6 -14 0 -41 9 -60 22 -68 45 -60 150 14 182 40 18 41 18 81 1z
m21 -41 c53 -52 16 -139 -60 -139 -64 0 -101 64 -71 122 18 34 28 40 74 41 22
1 41 -7 57 -24z m45 -84 c0 -18 -45 -71 -61 -71 -4 0 6 13 22 29 16 16 29 37
29 45 0 9 2 16 5 16 3 0 5 -8 5 -19z`,
      `M598 269 c-37 -21 -9 -77 32 -64 22 7 27 44 8 63 -14 14 -18 14 -40
-1z m38 -20 c9 -15 -11 -33 -30 -26 -9 4 -13 13 -10 22 7 17 30 20 40 4z`
    ];

    // SVGサイズ・バス本体範囲
    const SVG_W = 300, SVG_H = 139;
    const SVG_BODY_X_MIN = 40;   // ←本体左端
    const SVG_BODY_X_MAX = 3000;  // ←本体右端
    const SVG_BODY_WIDTH = SVG_BODY_X_MAX - SVG_BODY_X_MIN; // 220

    // Canvas
    const CANVAS_W = 600, CANVAS_H = 150;

    // 配置・拡大縮小
    let scale = CANVAS_W * 0.015 / SVG_W;
    const groundY = 145;
    let tx = (CANVAS_W - SVG_W * scale) / 5;

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let isJumping = false, velocity = 0, busY = groundY, gravity = 1.0, jumpPower = -14;
    let obstacles = [];
    let score = 0;
    let highScore = 0;
    let frame = 0;
    let gameOver = false;
    let started = false;

    function resetGame() {
      isJumping = false;
      velocity = 0;
      busY = groundY;
      obstacles = [];
      score = 0;
      frame = 0;
      gameOver = false;
      started = false;
      document.getElementById('retryBtn').style.display = 'none';
      drawIntro();
    }

    function jump() {
      if (!gameOver && busY >= groundY) {
        isJumping = true;
        velocity = jumpPower;
        started = true;
      }
    }

    function updateGame() {
      if (gameOver) return;
      frame++;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.strokeStyle = "#fff";
      ctx.beginPath();
      ctx.moveTo(0, groundY + 24);
      ctx.lineTo(canvas.width, groundY + 24);
      ctx.stroke();

      drawType2();

      if (frame % 65 === 0) {
        const height = Math.random() > 0.5 ? 32 : 50;
        obstacles.push({ x: canvas.width, h: height });
      }

      // バス本体の矩形（判定範囲を本体全体に）
      let busBodyX = tx + SVG_BODY_X_MIN * scale;
      let busBodyY = busY - SVG_H * scale;
      let busBodyW = SVG_BODY_WIDTH * scale;
      let busBodyH = SVG_H * scale;

      for (let i = 0; i < obstacles.length; i++) {
        obstacles[i].x -= 7;
        drawCactus(obstacles[i].x, groundY + 24 - obstacles[i].h, obstacles[i].h);

        let obsX = obstacles[i].x;
        let obsY = groundY + 24 - obstacles[i].h;
        let obsW = 12;
        let obsH = obstacles[i].h;

        // ★バス本体全体でAABB判定
        if (
          obsX < busBodyX + busBodyW &&
          obsX + obsW > busBodyX &&
          obsY < busBodyY + busBodyH &&
          obsY + obsH > busBodyY
        ) {
          gameOver = true;
          highScore = Math.max(score, highScore);
          setTimeout(() => {
            document.getElementById('retryBtn').style.display = 'inline-block';
          }, 600);
        }
      }
      obstacles = obstacles.filter(obj => obj.x > -20);

      if (isJumping || busY < groundY) {
        busY += velocity;
        velocity += gravity;
        if (busY >= groundY) {
          busY = groundY;
          isJumping = false;
        }
      }

      if (started && !gameOver) score++;
      ctx.font = '16px monospace';
      ctx.fillStyle = '#fff';
      ctx.fillText("SCORE: " + score, 460, 30);
      ctx.fillText("HI: " + highScore, 340, 30);

      if (!gameOver) {
        requestAnimationFrame(updateGame);
      } else {
        ctx.font = 'bold 36px monospace';
        ctx.fillText("GAME OVER", 190, 85);
      }
    }

    // バス描画
    function drawType2() {
      ctx.save();
      ctx.translate(tx, busY);
      ctx.scale(scale, -scale);
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 0.5 / scale;
      svgPaths.forEach(pathStr => {
        let p = new Path2D(pathStr);
        ctx.stroke(p);
      });
      ctx.restore();
    }

    function drawCactus(x, y, h) {
      ctx.fillStyle = "#fff";
      ctx.fillRect(x, y, 12, h);
      if (h > 40) {
        ctx.fillRect(x - 4, y + 10, 6, 10);
        ctx.fillRect(x + 10, y + 20, 6, 10);
      }
    }

    function drawIntro() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.font = 'bold 28px monospace';
      ctx.fillStyle = '#fff';
      ctx.fillText("Press SPACE or TAP to Start!", 90, 90);
      drawType2();
    }

    // Controls
    document.addEventListener('keydown', e => {
      if (e.code === "Space") {
        if (!started) {
          started = true;
          updateGame();
        } else if (!gameOver) {
          jump();
        } else {
          resetGame();
        }
      }
    });

    document.addEventListener('touchstart', e => {
      if (!started) {
        started = true;
        updateGame();
      } else if (!gameOver) {
        jump();
      } else {
        resetGame();
      }
    });

    document.getElementById('retryBtn').onclick = resetGame;

    drawIntro();
  </script>
</body>
</html>
